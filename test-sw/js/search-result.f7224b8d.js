(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["search-result"],{"0a49":function(t,e,i){var a=i("9b43"),o=i("626a"),s=i("4bf8"),n=i("9def"),r=i("cd1c");t.exports=function(t,e){var i=1==t,c=2==t,l=3==t,u=4==t,d=6==t,h=5==t||d,p=e||r;return function(e,r,f){for(var y,m,v=s(e),g=o(v),b=a(r,f,3),w=n(g.length),L=0,k=i?p(e,w):c?p(e,0):void 0;w>L;L++)if((h||L in g)&&(y=g[L],m=b(y,L,v),t))if(i)k[L]=m;else if(m)switch(t){case 3:return!0;case 5:return y;case 6:return L;case 2:k.push(y)}else if(u)return!1;return d?-1:l||u?u:k}}},1169:function(t,e,i){var a=i("2d95");t.exports=Array.isArray||function(t){return"Array"==a(t)}},"20d6":function(t,e,i){"use strict";var a=i("5ca1"),o=i("0a49")(6),s="findIndex",n=!0;s in[]&&Array(1)[s](function(){n=!1}),a(a.P+a.F*n,"Array",{findIndex:function(t){return o(this,t,arguments.length>1?arguments[1]:void 0)}}),i("9c6c")(s)},"264e":function(t,e,i){t.exports=i.p+"img/no_search_found.22da315a.png"},"481b8":function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ul",{staticClass:"search-result-page"},[t.list.length?a("scroll",{ref:"scroll",attrs:{data:t.list},on:{onPullingUp:t.pullingUp}},t._l(t.list,function(e){return a("li",{key:e.productId,on:{click:function(i){return t.toDetail(e)}}},[a("div",{staticClass:"title"},[t._v(t._s(e.productName))]),a("div",{staticClass:"info"},[a("div",{staticClass:"address"},[t._v(t._s(e.address))]),a("div",{staticClass:"distance"},[t._v(t._s(t.normalizeDis(e.distance)))])])])}),0):t._e(),a("li",{directives:[{name:"show",rawName:"v-show",value:!t.list.length&&t.isloaded,expression:"!list.length && isloaded"}],staticClass:"not-found"},[a("img",{attrs:{src:i("264e")}}),a("div",[t._v(t._s(t.$t("search.notFound")))])])],1)},o=[],s=(i("20d6"),i("75fc")),n=(i("c5f6"),i("ac2d")),r=i("ef39"),c=i("b4c2"),l=i("90fe"),u=i("ed08"),d=c["a"].queryLvmama,h=c["a"].queryHotel,p=c["a"].queryKeyword,f="zh-CN"===Object(l["d"])("lang")?"zh":"en",y={components:{Scroll:r["a"]},data:function(){return{isloaded:!1,isTicket:!1,isHotels:!1,isRoute:!1,isOther:!1,gLat:"31.233492",gLon:"121.505401",bLat:"31.233492",bLon:"121.505401",keyword:"",type:"",pageNum:1,pageSize:20,start:0,offset:20,hasNextPage:!1,list:[]}},mounted:function(){var t=this;n["a"].setAppTitle({title:this.$t("header.search")}),n["a"].gainLocation(function(e){var i=e.result,a=i.gdLatitude,o=i.gdLongitude,s=i.bdLatitude,n=i.bdLongitude;t.gLat=a||"31.233492",t.gLon=o||"121.505401",t.bLat=s||"31.233492",t.bLon=n||"121.505401",t.keyword=t.$route.query.keyword,t.type=t.$route.query.type,t.filterType()},this)},methods:{filterType:function(){switch(this.type){case"ticket":this.isTicket=!0;var t=this.isZH?"api.com.oneMobile.".concat(this.type,".keywordSearch"):"api.com.oneMobile.".concat(this.type,".internationalSearch");this.loadLvmama(this.keyword,t);break;case"hotels":this.isHotels=!0,this.loadHotel(this.keyword);break;case"route":this.isRoute=!0;var e=this.isZH?"api.com.oneMobile.".concat(this.type,".keywordSearch"):"api.com.oneMobile.".concat(this.type,".internationalSearch");this.loadLvmama(this.keyword,e);break;case"other":this.isOther=!0,this.loadOther(this.keyword);break}},loadLvmama:function(t,e){var i=this;d({keyword:t,method:e,lat:this.bLat,lon:this.bLon,pageNum:this.pageNum,pageSize:this.pageSize,language:this.isZH?"zh":"en",cityName:"上海"}).then(function(t){if(i.isloaded=!0,0===Number(t.code)){var e=t.data.ticketList.length?t.data.ticketList:t.data.routeList;i.list=[].concat(Object(s["a"])(i.list),Object(s["a"])(e)),i.hasNextPage=t.data.hasNext}}).catch(function(){i.isloaded=!0})},loadHotel:function(t){var e=this;h({keyword:t,loLat:this.gLat,loLng:this.gLon,page:this.pageNum-1,size:this.pageSize,language:this.isZH?"ZH":"EN",cityName:"上海"}).then(function(t){if(e.isloaded=!0,0===Number(t.code)){var i=t.data.result.map(function(t){return t.h5Url="http://booking.visitshanghai.com.cn/hotelbooking/hotel/index.html#/detail?innId=".concat(t.productId),t});e.list=[].concat(Object(s["a"])(e.list),Object(s["a"])(i)),e.hasNextPage=t.data.totalRowNum!==t.data.result.length}}).catch(function(){e.isloaded=!0})},loadOther:function(t){var e=this;p({keyword:t,lat:this.gLat,lon:this.gLon,start:this.start,offset:this.offset}).then(function(t){if(e.isloaded=!0,0===Number(t.code)){var i=t.data.result.map(function(t){return t.distance=(t.dis/1e3).toFixed(1),t.productId=t.id,t.productName=t.title,e.isEN&&(t.address=t.addressEn),t});e.list=[].concat(Object(s["a"])(e.list),Object(s["a"])(i)),e.hasNextPage=!!t.data.length}}).catch(function(){e.isloaded=!0})},pullingUp:function(){if(this.hasNextPage)if(this.isTicket){this.pageNum++;var t=this.isZH?"api.com.oneMobile.".concat(this.type,".keywordSearch"):"api.com.oneMobile.".concat(this.type,".internationalSearch");this.loadLvmama(this.keyword,t)}else if(this.isHotels)this.pageNum++,this.loadHotel(this.keyword);else if(this.isRoute){this.pageNum++;var e=this.isZH?"api.com.oneMobile.".concat(this.type,".keywordSearch"):"api.com.oneMobile.".concat(this.type,".internationalSearch");this.loadLvmama(this.keyword,e)}else this.isOther&&(this.start+=this.offset,this.loadOther(this.keyword));else this.$refs.scroll.closePullUp()},getHistory:function(){return Object(l["d"])("history_".concat(f))?JSON.parse(Object(l["d"])("history_".concat(f))):[]},saveHistory:function(t){var e=this,i=t.id||t.productId,a=this.getHistory(),o=a.findIndex(function(t){return t.type===e.type}),n=a[o].history;n.some(function(t){return t.id===i})&&n.splice(n.findIndex(function(t){return t.id===i}),1),n.unshift({id:i,title:t.productName,h5Url:t.h5Url}),n.length>5&&(a[o].history=Object(s["a"])(n).slice(0,5)),Object(l["f"])("history_".concat(f),JSON.stringify(a))},toDetail:function(t){this.saveHistory(t),t.h5Url?n["a"].openNewWebView({url:t.h5Url,isFitWindow:!0}):n["a"].openNewWebView({url:Object(u["b"])("/list-detail/".concat(t.id)),isFitWindow:!1})},normalizeDis:function(t){if(!t)return"";var e=parseFloat(t).toFixed(1);return e.length>5?"":"".concat(e,"km")}}},m=y,v=(i("a937"),i("2877")),g=Object(v["a"])(m,a,o,!1,null,"4dfef0eb",null);e["default"]=g.exports},7451:function(t,e,i){},a937:function(t,e,i){"use strict";var a=i("b475"),o=i.n(a);o.a},b475:function(t,e,i){},cd1c:function(t,e,i){var a=i("e853");t.exports=function(t,e){return new(a(t))(e)}},e0c6:function(t,e,i){"use strict";var a=i("7451"),o=i.n(a);o.a},e853:function(t,e,i){var a=i("d3f4"),o=i("1169"),s=i("2b4c")("species");t.exports=function(t){var e;return o(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!o(e.prototype)||(e=void 0),a(e)&&(e=e[s],null===e&&(e=void 0))),void 0===e?Array:e}},ed08:function(t,e,i){"use strict";i.d(e,"b",function(){return a}),i.d(e,"a",function(){return o});i("28a5");var a=function(t){return window.location.href.split("#")[0]+"#"+t},o=function(){return new Promise(function(t,e){if(window.AMap)t(window.AMap);else{var i=document.createElement("script");i.type="text/javascript",i.async=!0,i.src="http://webapi.amap.com/maps?v=1.4.14&callback=initAMap&key=555c914c29cb33d914437914f1b79b49",i.onerror=e,document.head.appendChild(i)}window.initAMap=function(){t(window.AMap)}})}},ef39:function(t,e,i){"use strict";var a=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"wrapper",staticClass:"scroll-wrapper"},[a("div",{staticClass:"scroll-content"},[t._t("default"),t._t("pullup",[t.hasMore?a("div",{staticClass:"pullup-wrapper"},[a("img",{directives:[{name:"show",rawName:"v-show",value:t.hasMore,expression:"hasMore"}],staticClass:"loading",attrs:{src:i("cf63")}}),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.hasMore&&t.data.length>0,expression:"!hasMore && data.length>0"}],staticClass:"no-more"},[t._v(t._s(t.noMoreData))])]):t._e()],{pullUpLoad:t.pullUpLoad,isPullUpLoad:t.isPullUpLoad,isNoMore:t.isNoMore})],2)])},o=[],s=(i("c5f6"),i("1fba")),n={props:{data:{type:Array,default:function(){return[]}},bounce:Boolean,pullUpLoad:{type:Boolean,default:!0},click:{type:Boolean,default:!0},probeType:{type:Number,default:1},refreshDelay:{type:Number,default:20},noMoreData:{type:String},hasMore:{type:Boolean},attachScroll:{type:Boolean,default:!1}},data:function(){return{isPullUpLoad:!1,isNoMore:!1}},methods:{initScroll:function(){var t=this;if(this.$refs.wrapper){var e={bounce:this.bounce,click:this.click,pullUpLoad:this.pullUpLoad,probeType:this.probeType};this.scroll=new s["a"](this.$refs.wrapper,e),this.pullUpLoad&&this.addEventPullUpLoad(),this.attachScroll&&this.scroll.on("scroll",function(e){Math.abs(e.y)>=100?t.$store.commit("SET_HEADER_BAR",!0):t.$store.commit("SET_HEADER_BAR",!1)})}},handlePullingUp:function(){this.isPullUpLoad=!0,this.$emit("onPullingUp")},addEventPullUpLoad:function(){this.scroll.on("pullingUp",this.handlePullingUp)},removeEventPullUpLoad:function(){this.scroll.off("pullingUp",this.handlePullingUp)},closePullUp:function(){this.isPullUpLoad=!1,this.isNoMore=!0,this.removeEventPullUpLoad()},forceUpdate:function(){this.pullUpLoad&&this.isPullUpLoad&&(this.isPullUpLoad=!1,this.scroll.finishPullUp()),this.refresh()},refresh:function(){this.scroll.refresh()}},mounted:function(){var t=this;setTimeout(function(){t.initScroll()},20)},destroyed:function(){this.scroll.destroy()},watch:{data:function(){var t=this;setTimeout(function(){t.forceUpdate()},this.refreshDelay)}}},r=n,c=(i("e0c6"),i("2877")),l=Object(c["a"])(r,a,o,!1,null,"9c17b8a2",null);e["a"]=l.exports}}]);